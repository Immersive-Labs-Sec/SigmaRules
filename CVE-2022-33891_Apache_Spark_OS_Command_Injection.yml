title: CVE-2022-33891 Apache Spark OS Command Injection Vulnerability Detection
status: stable
description: This SIGMA rule file is capable of detecting potential Apache Sparks OS command injection exploit attempts. CVE-2022-33891 affects Apache Spark up to 3.0.3/3.1.2/3.2.1.
author: Immersive Labs - Nikolas Cemerikic
references:
   - https://www.socinvestigation.com/cve-2022-33891-apache-spark-shell-command-injection-detection-response/
   - https://securityonline.info/cve-2022-33891-apache-spark-shell-command-injection-vulnerability/
date: 22/07/2022
logsource:
   category: webserver
detection:
   paramaterEndpoint:
       cs-method: 'GET'
       sc-status: '403'
       c-uri|contains: '?doAs='
   specialCharacters:
     c-uri|contains: 
      - '`'
      - '$'
      - '('
      - ')'
      - '|'
   condition: paramaterEndpoint AND specialCharacters
falsepositives:
   - Unlikely
level: Critical
tags:
   - attack.persistence
   - attack.t1190
